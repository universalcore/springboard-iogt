{% extends "base.jinja2" %}
{% from "molecules/section_heading.jinja2" import section_banner, section_title %}
{% from "molecules/page_listing.jinja2" import page_listing %}

{% block content %}
<div>
        {{ section_title(section) }}

        {% set localisation=section.set_indexes(all_localisations).filter(locale=language)[0] %}
        {{ section_banner(section, localisation) }}

        {% set featured_pages=section.set_indexes(all_pages).filter(language=language, featured=True).order_by('-created_at')[:2] %}
        {% if featured_pages %}
        <div class="articles latest">
            <div class="h1">{{ _('Latest') }}</div>
            {% for page in featured_pages %}
                {{ page_listing(page.to_object()) }}
            {% endfor %}
        </div>
        {% endif %}

        {% for category in section.set_indexes(all_categories).filter(language=language) %}
            {% set category_pages=all_pages.filter(primary_category=category.uuid).order_by('-created_at')[:1] %}
            {% if category_pages %}
            <div class="articles">
                <div class="h1">
                    <a href="{{ 'category'|route_url(uuid=category.uuid) }}">{{ category.title }}</a>
                </div>
                {% for page in category_pages %}
                    {{ page_listing(page.to_object()) }}
                {% endfor %}
                <div class="pagination">
                    <a href="{{ 'category'|route_url(uuid=category.uuid) }}">{{ _('See all in category') }}</a>
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endblock %}
